# Feature Specification: 에이전트 지침 통합 관리

**Feature Branch**: `036-unified-agent-context`
**Created**: 2026-02-27
**Status**: Draft
**Input**: User description: "나는 클로드와 코덱스를 번갈아가며 활용해서 개발하고 있어. 이슈 종류나 잔여 토큰에 따라 다른 에이전트를 사용해. 그러다 보니 AGENTS.md와 CLAUDE.md가 적절히 업데이트되지 않고 파편화되는거 같아. 한 곳에서 에이전트 지침을 관리하고 각각 에이전트의 루트 문서에서는 이를 링크하도록 하는 방식이 어떨까?"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 단일 문서로 공통 지침 관리 (Priority: P1)

개발자가 프로젝트 지침(기술 스택, 디렉터리 구조, 코딩 컨벤션, 명령어 등)을 업데이트할 때, 에이전트 종류에 관계없이 한 곳만 수정하면 모든 에이전트가 동일한 최신 정보를 갖는다.

**Why this priority**: 지침이 에이전트별로 파편화되면 Claude와 Codex가 서로 다른 규칙을 적용해 코드 스타일·구조가 불일치하게 된다. 이것이 이 피처의 핵심 문제다.

**Independent Test**: 공통 지침 문서를 하나 수정했을 때, Claude 세션과 Codex 세션 모두에서 변경된 내용이 반영되는지 확인하여 단독으로 검증 가능하다.

**Acceptance Scenarios**:

1. **Given** 프로젝트 공통 지침이 단일 문서에 있을 때, **When** 개발자가 그 문서에서 코딩 컨벤션을 수정하면, **Then** 다음 Claude 세션과 Codex 세션 모두 수정된 내용을 사용한다.
2. **Given** 개발자가 Claude를 사용하다가 Codex로 전환할 때, **When** 새 에이전트 세션을 시작하면, **Then** 동일한 프로젝트 컨텍스트(스택, 구조, 컨벤션)를 별도 전달 없이 인지한다.
3. **Given** 새 기능 구현 후 지침 업데이트가 필요할 때, **When** 개발자가 공통 문서만 수정하면, **Then** 별도로 CLAUDE.md와 AGENTS.md를 각각 수정하지 않아도 된다.

---

### User Story 2 - 에이전트별 고유 설정 유지 (Priority: P2)

각 에이전트(Claude, Codex)에는 공통 지침 외에 해당 에이전트 전용 설정이 존재할 수 있다. 개발자는 공통 부분과 에이전트별 부분을 명확히 구분하여 관리할 수 있다.

**Why this priority**: 공통화 이후에도 에이전트마다 고유한 동작 방식이나 제약이 있다. 이를 공통 문서와 분리해 관리해야 혼선 없이 유지보수할 수 있다.

**Independent Test**: 에이전트 전용 설정만 변경했을 때 다른 에이전트에 영향이 없는지, 에이전트 루트 문서에서 공통 문서와 전용 설정이 명확히 구분되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** CLAUDE.md와 AGENTS.md가 공통 지침을 참조하고 있을 때, **When** CLAUDE.md에만 Claude 전용 설정을 추가하면, **Then** AGENTS.md에는 영향을 주지 않는다.
2. **Given** 에이전트 루트 문서를 열었을 때, **When** 내용을 확인하면, **Then** "공통 지침" 영역과 "에이전트 전용" 영역이 구분되어 어느 부분을 수정해야 하는지 명확히 알 수 있다.

---

### Edge Cases

- 공통 지침 문서가 누락되거나 경로가 변경된 경우 에이전트가 어떻게 동작하는가?
- 공통 지침과 에이전트별 설정이 충돌하는 항목이 있을 경우 어느 쪽을 우선하는가?
- speckit의 에이전트 컨텍스트 자동 업데이트 스크립트가 공통 문서를 덮어쓰지 않도록 어떻게 보장하는가?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 프로젝트 내에 공통 에이전트 지침을 담는 단일 문서가 존재해야 한다.
- **FR-002**: CLAUDE.md는 해당 공통 문서를 참조하며, Claude 전용 설정은 별도 영역에 포함할 수 있어야 한다.
- **FR-003**: AGENTS.md는 해당 공통 문서를 참조하며, Codex 전용 설정은 별도 영역에 포함할 수 있어야 한다.
- **FR-004**: 공통 문서를 수정하는 것만으로 모든 에이전트에 변경 사항이 전달되어야 하며, 에이전트 루트 문서를 별도로 수정할 필요가 없어야 한다.
- **FR-005**: speckit의 에이전트 컨텍스트 자동 업데이트는 공통 문서의 내용을 유지하거나 올바르게 갱신해야 하며, 기존 내용을 손실시켜서는 안 된다.
- **FR-006**: 에이전트 루트 문서(CLAUDE.md, AGENTS.md)는 공통 지침을 중복 기술하지 않아야 한다.

### Key Entities

- **공통 에이전트 지침 문서**: 프로젝트 기술 스택, 디렉터리 구조, 명령어, 코딩 컨벤션, 중요 규칙 등 에이전트 종류와 무관하게 공유되는 모든 정보를 담는 단일 문서
- **에이전트 루트 문서 (CLAUDE.md, AGENTS.md)**: 각 에이전트가 프로젝트 진입 시 가장 먼저 읽는 문서. 공통 지침 문서를 참조하고, 해당 에이전트 전용 설정만 직접 포함
- **에이전트 전용 설정**: 특정 에이전트에만 적용되는 동작 방식, 도구 사용 제약, 워크플로우 차이 등

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 공통 지침을 수정할 때 수정해야 할 파일이 기존 2개(CLAUDE.md, AGENTS.md)에서 1개로 줄어든다.
- **SC-002**: 새 에이전트 세션을 시작한 후 프로젝트 컨텍스트를 별도로 설명하지 않아도 에이전트가 올바른 기술 스택·컨벤션을 적용하여 코드를 생성한다.
- **SC-003**: 구조 개편 후 CLAUDE.md와 AGENTS.md 간에 공통 지침 항목의 내용 불일치가 0건이다.
- **SC-004**: speckit의 자동 업데이트 스크립트 실행 이후에도 공통 지침 문서의 내용이 보존된다.

## Assumptions

- CLAUDE.md는 Claude Code(CLI)가 자동으로 읽는 파일이며, AGENTS.md는 Codex(OpenAI)가 자동으로 읽는 파일이다.
- 두 에이전트 모두 프로젝트 루트에서 다른 문서를 직접 참조(링크)하는 방식을 지원한다고 가정한다.
- speckit의 `.specify/scripts/bash/update-agent-context.sh`는 이 구조 개편 이후에도 동작해야 하며, 스크립트 수정이 이 작업 범위에 포함된다.
